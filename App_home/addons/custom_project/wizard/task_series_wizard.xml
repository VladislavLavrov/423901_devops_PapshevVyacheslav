<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_task_series_wizard_form" model="ir.ui.view">
        <field name="name">project.task.series.wizard.form</field>
        <field name="model">project.task.series.wizard</field>
        <field name="arch" type="xml">
            <form string="Планирование производственного расписания">
                <sheet>
                    <div class="oe_title">
                        <h1>Планирование производственного расписания</h1>
                        <div class="text-muted">Настройте параметры для автоматического создания работ по техпроцессу</div>
                    </div>

                    <group>
                        <group string="Основные параметры производства">
                            <field name="project_id" 
                                   required="1" 
                                   widget="many2one" 
                                   options="{'no_create': True}"/>
                            
                            <field name="product_type" 
                                   required="1" 
                                   widget="radio" 
                                   options="{'horizontal': true}"/>
                            
                            <field name="production_volume" 
                                   required="1" 
                                   widget="float" 
                                   class="oe_inline"/>
                            <label for="production_volume" string="тонн"/>
                        </group>

                        <group string="Параметры планирования">
                            <field name="process_type" 
                                   required="1" 
                                   widget="radio" 
                                   options="{'horizontal': true}"/>
                            
                            <field name="start_shift_number" 
                                   required="1" 
                                   widget="selection"/>
                            
                            <field name="shift_count" 
                                   required="1" 
                                   widget="selection"/>
                            
                            <field name="equipment_maintenance_days" 
                                   required="1" 
                                   widget="integer"/>
                        </group>
                    </group>

                    <group>
                        <group string="Даты и приоритет">
                            <field name="date_start" 
                                   required="1" 
                                   widget="date"
                                   class="oe_inline"/>
                            
                            <field name="priority_level" 
                                   required="1" 
                                   widget="radio" 
                                   options="{'horizontal': true}"/>
                        </group>
                    </group>

                    <div class="alert alert-info" role="alert" attrs="{'invisible': [('estimated_tasks_count', '=', 0)]}">
                        <i class="fa fa-industry me-2"></i>
                        <span class="fw-bold">Предварительный расчет производственного плана</span>
                        <hr class="my-2"/>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <strong><i class="fa fa-tasks me-1"></i>Будет создано работ:</strong><br/>
                                <span class="h4 text-primary">
                                    <field name="estimated_tasks_count" readonly="1"/>
                                </span>
                            </div>
                            
                            <div class="col-md-6">
                                <strong><i class="fa fa-calendar me-1"></i>Производственный период:</strong><br/>
                                <span class="h5">
                                    с <field name="date_start_display" readonly="1" class="d-inline fw-bold"/>
                                    по <field name="estimated_end_date" readonly="1" class="d-inline fw-bold"/>
                                </span>
                            </div>
                        </div>
                        
                        <div class="row mt-2">
                            <div class="col-12">
                                <small class="text-muted">
                                    <i class="fa fa-info-circle me-1"></i>
                                    Расчет основан на технологических картах производства
                                </small>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-warning" role="alert" attrs="{'invisible': [('equipment_maintenance_days', '=', 0)]}">
                        <i class="fa fa-wrench me-2"></i>
                        <strong>Внимание!</strong>
                        <span>
                            В расписание добавлено 
                            <field name="equipment_maintenance_days" readonly="1" class="d-inline fw-bold"/> 
                            дней на техническое обслуживание оборудования.
                        </span>
                    </div>
                </sheet>

                <footer>
                    <button name="action_preview_schedule" 
                            string="Предварительный просмотр" 
                            type="object" 
                            class="btn-info"
                            attrs="{'invisible': [('estimated_tasks_count', '=', 0)]}"/>
                    
                    <button name="action_create_series" 
                            string="Создать расписание" 
                            type="object" 
                            class="btn-primary"
                            attrs="{'invisible': [('estimated_tasks_count', '=', 0)]}"/>
                    
                    <button string="Отмена" special="cancel" class="btn-secondary"/>
                </footer>
            </form>
        </field>
    </record>

    <record id="action_task_series_wizard" model="ir.actions.act_window">
        <field name="name">Планирование производства</field>
        <field name="res_model">project.task.series.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="binding_model_id" ref="project.model_project_project"/>
        <field name="binding_type">action</field>
    </record>

    <!-- Кнопка в проектах -->
    <record id="project_project_action_series" model="ir.actions.server">
        <field name="name">Создать производственное расписание</field>
        <field name="model_id" ref="project.model_project_project"/>
        <field name="binding_model_id" ref="project.model_project_project"/>
        <field name="state">code</field>
        <field name="code">
            action = env["ir.actions.act_window"].for_xml_id("your_module", "action_task_series_wizard")
        </field>
    </record>
</odoo>